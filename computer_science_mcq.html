<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>MCQs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        /* ============ Reset ============ */
        * {
            box-sizing: border-box;
        }

        html,
        body {
            margin: 0;
            height: 100%;
            font-family: system-ui, Arial, sans-serif;
            background: #f4f4f4;
        }

        /* ============ App Layout ============ */
        body {
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* ============ Top Bar ============ */
        #topbar {
            height: 56px;
            background: #2c3e50;
            color: #fff;
            display: flex;
            align-items: center;
            padding: 0 16px;
            flex-shrink: 0;
        }

        #menuBtn {
            font-size: 22px;
            background: none;
            border: none;
            color: #fff;
            cursor: pointer;
            margin-right: 12px;
        }

        #title {
            font-size: 18px;
            font-weight: 600;
        }

        /* ============ Main Area ============ */
        #main {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* ============ Sidebar ============ */
        #sidebar {
            width: 260px;
            background: #2c3e50;
            color: #fff;
            padding: 15px;
            overflow-y: auto;
            flex-shrink: 0;
        }

        #sidebar h3 {
            margin-top: 0;
            text-align: center;
        }

        #sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #sidebar li {
            padding: 10px;
            cursor: pointer;
            border-radius: 6px;
        }

        #sidebar li:hover {
            background: #34495e;
        }

        /* ============ Content ============ */
        #content {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
        }

        /* ============ Questions ============ */
        .section {
            display: none;
        }

        .question {
            background: #fff;
            padding: 14px;
            margin-bottom: 14px;
            border-radius: 10px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, .08);
        }

        .options label {
            display: block;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
        }

        .correct {
            background: #d4edda;
        }

        .wrong {
            background: #f8d7da;
        }

        .feedback {
            font-weight: 600;
            margin-top: 6px;
        }

        .explanation {
            display: none;
            font-style: italic;
            color: #555;
        }

        .progress {
            font-weight: 600;
            margin-bottom: 10px;
        }

        /* ============ Score ============ */
        #scoreSummary {
            margin-top: 10px;
            padding: 10px;
            background: #3498db;
            border-radius: 6px;
            display: none;
        }

        /* ============ Mobile Drawer ============ */
        @media (max-width: 768px) {

            #sidebar {
                position: fixed;
                top: 56px;
                left: 0;
                height: calc(100vh - 56px);
                transform: translateX(-100%);
                transition: transform .25s ease;
                z-index: 1000;
            }

            #sidebar.open {
                transform: translateX(0);
            }
        }

        /* ============ Custom Topic Dropdown ============ */

        #topicSelect-wrapper {
            margin-bottom: 12px;
        }

        .custom-select {
            position: relative;
            user-select: none;
        }

        .custom-select .selected {
            padding: 10px 12px;
            background: #ffffff;
            color: #2c3e50;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .custom-select .selected::after {
            content: "▾";
            font-size: 12px;
            opacity: 0.7;
        }

        .custom-select.open .selected::after {
            transform: rotate(180deg);
        }

        .custom-select .options {
            position: absolute;
            top: calc(100% + 6px);
            left: 0;
            width: 100%;
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
            list-style: none;
            padding: 6px;
            margin: 0;
            display: none;
            z-index: 2000;
        }

        .custom-select.open .options {
            display: block;
        }

        .custom-select .options li {
            padding: 10px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            color: #2c3e50;
        }

        .custom-select .options li:hover {
            background: #f0f6ff;
        }

        /* Selected / hover option text color fix */
        .custom-select .options li:hover,
        .custom-select .options li.active {
            color: #ffffff;
            background: #3498db;
        }


        #scoreBtn {
            width: 100%;
            padding: 10px 12px;
            margin-top: 12px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: #fff;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.15s ease, box-shadow 0.15s ease, opacity 0.15s;
        }

        #scoreBtn:hover {
            box-shadow: 0 6px 14px rgba(52, 152, 219, 0.35);
            transform: translateY(-1px);
            opacity: 0.95;
        }

        #scoreBtn:active {
            transform: translateY(0);
            box-shadow: 0 3px 8px rgba(52, 152, 219, 0.3);
        }

        #scoreBtn:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.4);
        }


        .home_btn {
            display: block;
            width: 100%;
            padding: 10px 12px;
            margin-top: 12px;
            margin-bottom: 14px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: #fff;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
            transition: transform 0.15s ease, box-shadow 0.15s ease, opacity 0.15s;
        }

        .home_btn:hover {
            box-shadow: 0 6px 14px rgba(52, 152, 219, 0.35);
            transform: translateY(-1px);
            opacity: 0.95;
        }

        .home_btn:active {
            transform: translateY(0);
            box-shadow: 0 3px 8px rgba(52, 152, 219, 0.3);
        }
    </style>
</head>

<body>

    <!-- ===== TOP BAR ===== -->
    <div id="topbar">
        <button id="menuBtn">☰</button>
        <div id="title">MCQs</div>
    </div>

    <!-- ===== MAIN ===== -->
    <div id="main">

        <div id="sidebar">
            <a href="index.html" class="home_btn">Home</a>
            <h3>Topics</h3>
            <div id="topicSelect-wrapper">
                <div class="custom-select" id="topicDropdown">
                    <div class="selected">Select Topic</div>
                    <ul class="options"></ul>
                </div>
            </div>
            <ul id="sectionList"></ul> <!-- THIS IS REQUIRED -->
            <button id="scoreBtn" onclick="showScore()" style="width:100%;margin-top:10px">Show Score</button>
            <div id="scoreSummary"></div>
        </div>


        <div id="content"></div>

    </div>

    <script>
        let data = {};
        let extraQs = [];

        // ================= Topic Map =================
        const topics = {
            "Programming Concepts": "programming_concepts.json",
            "Data Structures & Algorithms": "data_structures_algorithms.json",
            "Computer Networks": "computer_network.json",
            "DBMS": "dbms.json",
            "SQL": "sql.json",
            "Data Analytics Languages": "data_analytics_languages.json",
            "Information & Cyber Security": "information_cyber_security.json",
            "Data Warehousing": "data_warehousing.json",
            "Shell Programming": "shell_programming.json"
        };

        // ================= Custom Dropdown =================

        const dropdown = document.getElementById("topicDropdown");
        const selected = dropdown.querySelector(".selected");
        const optionsEl = dropdown.querySelector(".options");

        // Populate dropdown
        Object.entries(topics).forEach(([name, file]) => {
            const li = document.createElement("li");
            li.textContent = name;
            li.onclick = () => {
                selected.textContent = name;
                dropdown.classList.remove("open");
                fetchTopic(file);
            };
            optionsEl.appendChild(li);
        });

        // Toggle open/close
        selected.onclick = () => {
            dropdown.classList.toggle("open");
        };

        // Close on outside click
        document.addEventListener("click", e => {
            if (!dropdown.contains(e.target)) {
                dropdown.classList.remove("open");
            }
        });


        // ================= Fetch and Load Topic =================
        function fetchTopic(file) {
            fetch("questions/computer_science/" + file)
                .then(res => res.json())
                .then(json => {
                    data = json.data;
                    extraQs = data.extra_qs || [];
                    delete data.extra_qs;
                    loadTopic();

                    document.getElementById("scoreSummary").style.display = "none";
                })
                .catch(err => console.error("Failed to load JSON:", err));
        }

        // ================= Load Topic =================
        function loadTopic() {
            const content = document.getElementById("content");
            content.innerHTML = "";

            const sidebar = document.getElementById("sectionList");
            sidebar.innerHTML = "";

            // Build sections dynamically
            for (let section in data) {
                let li = document.createElement("li");
                li.textContent = section;
                li.onclick = () => showSection(section);
                sidebar.appendChild(li);

                generateSection(section, data[section]);
            }

            // "All Questions" link
            let liAll = document.createElement("li");
            liAll.textContent = "All Questions";
            liAll.onclick = () => showSection("AllQuestions");
            sidebar.appendChild(liAll);

            // Build "All Questions" section
            let allSec = document.createElement("div");
            allSec.className = "section";
            allSec.id = "AllQuestions";

            let h2 = document.createElement("h2");
            h2.textContent = "All Questions";
            allSec.appendChild(h2);

            let allQs = [];
            for (let s in data) {
                data[s].forEach(q => {
                    let copy = { ...q };
                    copy.section = s;
                    allQs.push(copy);
                });
            }

            extraQs.forEach(q => {
                q.isExtra = true;
                allQs.push(q);
            });

            allQs.sort(() => Math.random() - 0.5);
            allQs.forEach((q, i) => createQuestionDiv(q, allSec, "AllQuestions", i));
            content.appendChild(allSec);

            // Show first section by default
            showSection(Object.keys(data)[0]);
        }

        // ================= Core Functions =================
        function generateSection(name, questions) {
            let sec = document.createElement("div");
            sec.className = "section";
            sec.id = name.replace(/\s+/g, '');

            let h2 = document.createElement("h2");
            h2.textContent = name;
            sec.appendChild(h2);

            let prog = document.createElement("div");
            prog.className = "progress";
            prog.id = sec.id + "_progress";
            prog.textContent = `Answered: 0 / ${questions.length}`;
            sec.appendChild(prog);

            questions.forEach((q, i) => createQuestionDiv(q, sec, name, i));
            document.getElementById("content").appendChild(sec);
        }

        function createQuestionDiv(q, parent, section, idx) {
            let qDiv = document.createElement("div");
            qDiv.className = "question";
            if (q.isExtra) qDiv.dataset.isExtra = true;

            let h3 = document.createElement("h3");
            h3.textContent = `${idx + 1}. ${q.question}`;
            qDiv.appendChild(h3);

            let opts = document.createElement("div");
            opts.className = "options";

            q.options.forEach((opt, i) => {
                let lbl = document.createElement("label");
                let r = document.createElement("input");
                r.type = "radio";
                r.name = section.replace(/\s+/g, '') + "_" + idx;
                r.value = i;
                r.onclick = () => checkAnswer(section, idx, q, r);
                lbl.appendChild(r);
                lbl.append(" " + opt);
                opts.appendChild(lbl);
            });

            qDiv.appendChild(opts);

            let fb = document.createElement("div");
            fb.className = "feedback";
            fb.id = section.replace(/\s+/g, '') + "_" + idx + "_fb";
            qDiv.appendChild(fb);

            let exp = document.createElement("div");
            exp.className = "explanation";
            exp.id = section.replace(/\s+/g, '') + "_" + idx + "_exp";
            qDiv.appendChild(exp);

            parent.appendChild(qDiv);
        }

        function showSection(section) {
            document.querySelectorAll(".section").forEach(s => s.style.display = "none");
            document.getElementById(section.replace(/\s+/g, '')).style.display = "block";
            document.getElementById("sidebar").classList.remove("open");

            document.getElementById("scoreSummary").style.display = "none";
        }

        function checkAnswer(section, idx, q, radio) {
            let labels = radio.closest(".options").querySelectorAll("label");
            let fb = document.getElementById(section.replace(/\s+/g, '') + "_" + idx + "_fb");
            let exp = document.getElementById(section.replace(/\s+/g, '') + "_" + idx + "_exp");

            labels.forEach((l, i) => {
                l.classList.remove("correct", "wrong");
                l.querySelector("input").disabled = true;
                if (i === q.answer) l.classList.add("correct");
                if (i === +radio.value && i !== q.answer) l.classList.add("wrong");
            });

            radio.closest(".question").dataset.status =
                (+radio.value === q.answer) ? "correct" : "wrong";

            fb.textContent =
                (+radio.value === q.answer) ? "Correct!" : "Wrong! Correct: " + q.options[q.answer];
            fb.style.color = (+radio.value === q.answer) ? "green" : "red";

            exp.textContent = q.explanation;
            exp.style.display = "block";

            let sec = document.getElementById(section.replace(/\s+/g, ''));
            let total = sec.querySelectorAll(".question").length;
            let ans = sec.querySelectorAll(".question[data-status]").length;
            let prog = document.getElementById(section.replace(/\s+/g, '') + "_progress");
            if (prog) prog.textContent = `Answered: ${ans} / ${total}`;

            if (document.getElementById("scoreSummary").style.display === "block") showScore();
        }


        function showScore() {
            let total = 0, correct = 0, wrong = 0;

            // Get currently visible section
            const visibleSection = document.querySelector(".section[style*='display: block']");
            if (!visibleSection) return;

            // Count questions only inside this section
            visibleSection.querySelectorAll(".question").forEach(q => {
                total++;
                if (q.dataset.status === "correct") correct++;
                if (q.dataset.status === "wrong") wrong++;
            });

            const s = document.getElementById("scoreSummary");
            s.style.display = "block";
            s.innerHTML = `
        Total: ${total}<br>
        Correct: ${correct}<br>
        Wrong: ${wrong}<br>
        Unanswered: ${total - correct - wrong}
    `;
        }


        document.getElementById("menuBtn").onclick = () => {
            document.getElementById("sidebar").classList.toggle("open");
        };

        // ================= Initial Load =================
        window.addEventListener("DOMContentLoaded", () => {
            const firstTopicName = Object.keys(topics)[0];
            const firstTopicFile = topics[firstTopicName];
            selected.textContent = firstTopicName;
            fetchTopic(firstTopicFile);
        });

    </script>




</body>

</html>